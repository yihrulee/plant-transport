<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>æ¤ç‰©çš„é‹è¼¸_å­¸ç¿’é é¢_ç¶­ç®¡æŸçš„åŠŸèƒ½èˆ‡åˆ†å¸ƒ</title>
  <style>
    :root{
      --violet:#667eea; --purple:#764ba2;
      --ink:#2d3748; --ink2:#4a5568; --muted:#e2e8f0;
      --ok:#48bb78; --okbg:#c6f6d5; --ng:#f56565; --ngbg:#fed7d7;
      --shadow:0 8px 25px rgba(0,0,0,.1);
      --kw-bundle:#0ea5e9;   --kw-xylem:#2563eb;  --kw-phloem:#d97706;
      --kw-water:#0891b2;    --kw-sugar:#16a34a;
      --kw-up:#7c3aed; --kw-down:#dc2626; --kw-in:#059669; --kw-out:#ca8a04;
    }
    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0; padding:0;
      font-family:"Microsoft JhengHei","Noto Sans TC",system-ui,-apple-system,"Segoe UI",Roboto,Arial,"PingFang TC","Heiti TC",sans-serif;
      color:var(--ink);
      background:linear-gradient(135deg,var(--violet) 0%,var(--purple) 100%);
    }
    .container{ max-width:1000px; margin:0 auto; min-height:100%; padding:22px; display:flex; flex-direction:column; }
    .card{ background:#fff; border-radius:15px; padding:30px; margin-bottom:22px; box-shadow:var(--shadow); }
    .header h1{ margin:0; color:#334155; font-size:2rem; font-weight:800; letter-spacing:.5px; }
    h2{ margin:0 0 16px; font-size:1.35rem; border-bottom:3px solid var(--violet); padding-bottom:8px; }
    p{ color:var(--ink2); line-height:1.9; font-size:1.06rem; }

    /* é—œéµå­—æ¨£å¼ */
    .kw{ font-weight:700; padding:0 .25rem; border-radius:4px; }
    .kw.bundle{ color:var(--kw-bundle); background:rgba(14,165,233,.10); }
    .kw.xylem{ color:var(--kw-xylem); background:rgba(37,99,235,.12); }
    .kw.phloem{ color:var(--kw-phloem); background:rgba(217,119,6,.12); }
    .kw.water{ color:var(--kw-water); background:rgba(8,145,178,.12); }
    .kw.sugar{ color:var(--kw-sugar); background:rgba(22,163,74,.12); }
    .kw.up{ color:var(--kw-up); background:rgba(124,58,237,.12); }
    .kw.down{ color:var(--kw-down); background:rgba(220,38,38,.12); }
    .kw.in{ color:var(--kw-in); background:rgba(5,150,105,.12); }
    .kw.out{ color:var(--kw-out); background:rgba(202,138,4,.12); }

    /* åˆ†å¸ƒç•«å»Š */
    .gallery{
      display:grid; grid-template-columns:1fr 1fr; gap:18px; align-items:start;
    }
    .gallery figure{ margin:0; }
    .gallery img{ width:100%; height:auto; border-radius:12px; border:2px solid var(--muted); display:block; background:#fff; cursor:zoom-in; }
    .caption{ color:#64748b; font-size:.9rem; margin-top:6px; }

    /* ç·´ç¿’å€ */
    .exercise{ background:#f7fafc; border-left:5px solid var(--violet); border-radius:12px; padding:22px; margin-top:4px; }
    .q{ margin:16px 0 18px; }
    .q-title{ font-weight:800; margin-bottom:10px; color:#1f2937; }
    .pair-row, .mcq{
      background:#fff; border:2px solid var(--muted); border-radius:12px; padding:14px;
      display:flex; align-items:center; gap:10px; flex-wrap:wrap; margin:10px 0;
    }
    .tag{ font-weight:700; min-width:112px; }
    .arrow{ color:var(--violet); font-weight:700; }
    .dropdown{
      border:2px solid var(--muted); border-radius:8px; background:#fff;
      padding:10px 42px 10px 12px; font-size:1rem; cursor:pointer;
      appearance:none; -webkit-appearance:none; -moz-appearance:none;
      transition:border-color .2s, box-shadow .2s, background-color .2s;
      background-image:url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' width='20' height='20' viewBox='0 0 20 20' fill='none'%3e%3cpath d='M6 8l4 4 4-4' stroke='%236b7280' stroke-width='1.6' stroke-linecap='round' stroke-linejoin='round'/%3e%3c/svg%3e");
      background-repeat:no-repeat; background-position:right 12px center; background-size:16px 16px;
    }
    .dropdown:hover{ border-color:var(--violet); background:#f0f4ff; }
    .dropdown:focus{ outline:none; border-color:var(--violet); box-shadow:0 0 0 3px rgba(102,126,234,.18); }
    .correct{ border-color:var(--ok)!important; background:var(--okbg)!important; }
    .incorrect{ border-color:var(--ng)!important; background:var(--ngbg)!important; }

    .btn{ border:0; border-radius:10px; padding:12px 18px; font-weight:700; cursor:pointer; }
    .btn-primary{ background:var(--violet); color:#fff; }
    .btn-primary:hover{ background:#5a67d8; }
    .btn-ghost{ background:#fff; color:#475569; border:2px solid var(--muted); }
    .btn[disabled]{ background:#a0aec0; cursor:not-allowed; }
    .btn-wrap{ display:flex; gap:10px; flex-wrap:wrap; }
    .result{ margin-top:10px; padding:12px; border-radius:8px; display:none; font-weight:700; border:1px solid transparent; }
    .result.ok{ background:var(--okbg); color:#22543d; border-color:var(--ok); }
    .result.ng{ background:var(--ngbg); color:#742a2a; border-color:var(--ng); }

    /* é€²åº¦æ¢ */
    .progress{ display:flex; align-items:center; gap:10px; margin-bottom:6px; }
    .bar{ flex:1; height:10px; background:#e5e7eb; border-radius:999px; overflow:hidden; }
    .bar > span{ display:block; height:100%; width:0%; background:linear-gradient(90deg,#67e8f9,#60a5fa); transition:width .25s ease; }

    .nav{ display:flex; justify-content:space-between; gap:12px; margin-top:22px; }
    .nav a{ text-decoration:none; display:inline-flex; align-items:center; gap:8px; padding:12px 22px; border-radius:25px; font-weight:700; }
    .nav .prev{ background:#fff; color:var(--violet); border:2px solid var(--violet); }
    .nav .prev:hover{ background:var(--violet); color:#fff; }
    .nav .next{ background:#fff; color:var(--violet); border:2px solid var(--violet); }
    .nav .next:hover{ background:var(--violet); color:#fff; }
    .next.disabled{ background:#e2e8f0!important; color:#a0aec0!important; border-color:#e2e8f0!important; pointer-events:none; cursor:not-allowed; }

    @media (max-width:900px){
      .gallery{ grid-template-columns:1fr; }
    }

    /* Lightbox */
    .lightbox{
      position:fixed; inset:0; background:rgba(0,0,0,.7);
      display:none; align-items:center; justify-content:center; z-index:50;
    }
    .lightbox.open{ display:flex; }
    .lightbox figure{ margin:0; max-width:min(92vw,1100px); max-height:92vh; }
    .lightbox img{ width:100%; height:auto; border-radius:12px; box-shadow:var(--shadow); }
    .close-btn{
      position:absolute; top:16px; right:16px; background:#fff; border:0; padding:10px 14px;
      border-radius:999px; font-weight:800; cursor:pointer;
    }
    .visually-hidden{ position:absolute !important; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0 0 0 0); white-space:nowrap; border:0; }
  </style>
</head>
<body>
  <main class="container">
    <!-- æ¨™é¡Œ -->
    <header class="card header" role="banner">
      <h1>æ¤ç‰©çš„é‹è¼¸_å­¸ç¿’é é¢_ç¶­ç®¡æŸçš„åŠŸèƒ½èˆ‡åˆ†å¸ƒ</h1>
    </header>

    <!-- æ®µè½ä¸€ï¼šåŠŸèƒ½ï¼ˆç´”æ–‡å­—ï¼Œç„¡åœ–ï¼‰ -->
    <section class="card" role="region" aria-labelledby="sec-func">
      <h2 id="sec-func">ç¶­ç®¡æŸçš„åŠŸèƒ½</h2>
      <p>
        æ¤ç‰©é«”å…§è² è²¬é‹è¼¸æ°´åˆ†èˆ‡é¤Šåˆ†çš„ç´°èƒï¼Œæ’åˆ—æˆæŸï¼Œç¨±ç‚º
        <span class="kw bundle">ç¶­ç®¡æŸ</span>ã€‚å…¶ä¸­é‹è¼¸
        <span class="kw water">æ°´åˆ†èˆ‡ç¤¦ç‰©è³ª</span>çš„ç‚º
        <span class="kw xylem">æœ¨è³ªéƒ¨</span>ï¼Œç´°èƒå£è¼ƒåšä¸¦å…·æ”¯æŒåŠŸèƒ½ï¼›
        å…‰åˆä½œç”¨æ‰€ç”¢ç”Ÿçš„<span class="kw sugar">å¯æº¶æ€§é¤Šåˆ†</span>å‰‡ç”±
        <span class="kw phloem">éŸŒçš®éƒ¨</span>è² è²¬é‹è¼¸ã€‚
      </p>
    </section>

    <!-- æ®µè½äºŒï¼šåˆ†å¸ƒï¼ˆå…©åœ–åŒæ®µï¼Œé›™æ¬„ç•«å»Šï¼‰ -->
    <section class="card" role="region" aria-labelledby="sec-dist">
      <h2 id="sec-dist">ç¶­ç®¡æŸçš„åˆ†å¸ƒ</h2>
      <p>
        ç¶­ç®¡æŸç´°èƒç´°é•·ï¼Œä¸Šä¸‹ç›¸æ¥å½¢æˆç®¡é“ï¼Œç”±æ ¹ã€è–å»¶ä¼¸è‡³è‘‰ã€èŠ±èˆ‡æœå¯¦ã€‚
        åœ¨<strong>è‘‰è„ˆ</strong>ä¸­ï¼Œ<span class="kw xylem">æœ¨è³ªéƒ¨</span>ä½åœ¨
        <span class="kw up">ä¸Šå´ï¼ˆé è¿‘ä¸Šè¡¨çš®ï¼‰</span>ï¼Œ
        <span class="kw phloem">éŸŒçš®éƒ¨</span>ä½åœ¨
        <span class="kw down">ä¸‹å´ï¼ˆé è¿‘ä¸‹è¡¨çš®ï¼‰</span>ï¼›
        åœ¨<strong>è–</strong>çš„æ©«åˆ‡é¢ï¼Œé€šå¸¸<span class="kw xylem">æœ¨è³ªéƒ¨</span>åœ¨
        <span class="kw in">å…§å´</span>ï¼Œ<span class="kw phloem">éŸŒçš®éƒ¨</span>åœ¨
        <span class="kw out">å¤–å´</span>ã€‚
      </p>
      <div class="gallery" aria-label="ç¶­ç®¡æŸåˆ†å¸ƒåœ–åº«">
        <figure>
          <img class="zoomable" src="11.png" alt="è‘‰çš„ç¶­ç®¡æŸåˆ†å¸ƒï¼šæœ¨è³ªéƒ¨åœ¨ä¸Šå´ã€éŸŒçš®éƒ¨åœ¨ä¸‹å´" loading="lazy">
          <figcaption class="caption">è‘‰è„ˆæ©«åˆ‡ç¤ºæ„ï¼š<b>æœ¨è³ªéƒ¨</b>åœ¨ä¸Šå´ã€<b>éŸŒçš®éƒ¨</b>åœ¨ä¸‹å´ã€‚</figcaption>
        </figure>
        <figure>
          <!-- è‹¥ä½ çš„åœ–æª”å« 111.jpgï¼Œå¯ç›´æ¥æŠŠ src æ›æˆ 111.jpgï¼›æˆ–ä¿ç•™ picture fallback -->
          <picture>
            <source srcset="111.png" type="image/png">
            <img class="zoomable" src="111.jpg" alt="è–çš„ç¶­ç®¡æŸåˆ†å¸ƒï¼šæœ¨è³ªéƒ¨åœ¨å…§å´ã€éŸŒçš®éƒ¨åœ¨å¤–å´" loading="lazy">
          </picture>
          <figcaption class="caption">è–éƒ¨æ©«åˆ‡ç¤ºæ„ï¼š<b>æœ¨è³ªéƒ¨</b>åœ¨å…§å´ã€<b>éŸŒçš®éƒ¨</b>åœ¨å¤–å´ã€‚</figcaption>
        </figure>
      </div>
    </section>

    <!-- äº’å‹•ç·´ç¿’ -->
    <section class="card exercise" role="region" aria-labelledby="exTitle">
      <h2 id="exTitle">äº’å‹•ç·´ç¿’</h2>

      <!-- é€²åº¦ -->
      <div class="progress" aria-live="polite">
        <div id="progText">å®Œæˆåº¦ï¼š0/3</div>
        <div class="bar" aria-hidden="true"><span id="progBar"></span></div>
      </div>

      <!-- Q1ï¼šåŠŸèƒ½é…å° -->
      <div class="q" role="group" aria-labelledby="q1">
        <div id="q1" class="q-title">é¡Œç›®ä¸€ï½œå®Œæˆé…å°ï¼šé¸å‡ºæœ¨è³ªéƒ¨èˆ‡éŸŒçš®éƒ¨çš„ä¸»è¦é‹è¼¸å°è±¡</div>

        <div class="pair-row" id="row-xylem">
          <span class="tag">æœ¨è³ªéƒ¨</span>
          <span class="arrow" aria-hidden="true">â†’</span>
          <label for="xylem" class="visually-hidden">æœ¨è³ªéƒ¨é‹è¼¸</label>
          <select id="xylem" class="dropdown" aria-label="æœ¨è³ªéƒ¨é‹è¼¸">
            <option value="">è«‹é¸æ“‡</option>
            <option value="æ°´åˆ†èˆ‡ç¤¦ç‰©è³ª">æ°´åˆ†èˆ‡ç¤¦ç‰©è³ª</option>
            <option value="å…‰åˆä½œç”¨çš„é¤Šåˆ†">å…‰åˆä½œç”¨çš„é¤Šåˆ†</option>
          </select>
        </div>

        <div class="pair-row" id="row-phloem">
          <span class="tag">éŸŒçš®éƒ¨</span>
          <span class="arrow" aria-hidden="true">â†’</span>
          <label for="phloem" class="visually-hidden">éŸŒçš®éƒ¨é‹è¼¸</label>
          <select id="phloem" class="dropdown" aria-label="éŸŒçš®éƒ¨é‹è¼¸">
            <option value="">è«‹é¸æ“‡</option>
            <option value="æ°´åˆ†èˆ‡ç¤¦ç‰©è³ª">æ°´åˆ†èˆ‡ç¤¦ç‰©è³ª</option>
            <option value="å…‰åˆä½œç”¨çš„é¤Šåˆ†">å…‰åˆä½œç”¨çš„é¤Šåˆ†</option>
          </select>
        </div>

        <div class="btn-wrap">
          <button id="check1" class="btn btn-primary" type="button" disabled aria-disabled="true" aria-controls="res1">æª¢æŸ¥ç­”æ¡ˆ</button>
          <button id="redo1" class="btn btn-ghost" type="button" hidden>é‡åšæœ¬é¡Œ</button>
        </div>
        <div id="res1" class="result" aria-live="polite"></div>
      </div>

      <!-- Q2ï¼šä½ç½®åˆ¤è®€ï¼ˆè‘‰èˆ‡è–ï¼‰ -->
      <div class="q" role="group" aria-labelledby="q2">
        <div id="q2" class="q-title">é¡Œç›®äºŒï½œå®Œæˆä½ç½®åˆ¤è®€ï¼ˆè‘‰è„ˆä¸Šä¸‹ã€è–çš„å…§å¤–ï¼‰</div>

        <div class="pair-row" id="row-leaf-x">
          <span class="tag">è‘‰è„ˆï¼šæœ¨è³ªéƒ¨</span>
          <span class="arrow" aria-hidden="true">â†’</span>
          <label for="leafX" class="visually-hidden">è‘‰è„ˆæœ¨è³ªéƒ¨ä½ç½®</label>
          <select id="leafX" class="dropdown" aria-label="è‘‰è„ˆæœ¨è³ªéƒ¨ä½ç½®">
            <option value="">è«‹é¸æ“‡</option>
            <option value="ä¸Šå´">ä¸Šå´ï¼ˆé è¿‘ä¸Šè¡¨çš®ï¼‰</option>
            <option value="ä¸‹å´">ä¸‹å´ï¼ˆé è¿‘ä¸‹è¡¨çš®ï¼‰</option>
          </select>
        </div>

        <div class="pair-row" id="row-leaf-p">
          <span class="tag">è‘‰è„ˆï¼šéŸŒçš®éƒ¨</span>
          <span class="arrow" aria-hidden="true">â†’</span>
          <label for="leafP" class="visually-hidden">è‘‰è„ˆéŸŒçš®éƒ¨ä½ç½®</label>
          <select id="leafP" class="dropdown" aria-label="è‘‰è„ˆéŸŒçš®éƒ¨ä½ç½®">
            <option value="">è«‹é¸æ“‡</option>
            <option value="ä¸Šå´">ä¸Šå´ï¼ˆé è¿‘ä¸Šè¡¨çš®ï¼‰</option>
            <option value="ä¸‹å´">ä¸‹å´ï¼ˆé è¿‘ä¸‹è¡¨çš®ï¼‰</option>
          </select>
        </div>

        <div class="pair-row" id="row-stem-x">
          <span class="tag">è–ï¼šæœ¨è³ªéƒ¨</span>
          <span class="arrow" aria-hidden="true">â†’</span>
          <label for="stemX" class="visually-hidden">è–æœ¨è³ªéƒ¨ä½ç½®</label>
          <select id="stemX" class="dropdown" aria-label="è–æœ¨è³ªéƒ¨ä½ç½®">
            <option value="">è«‹é¸æ“‡</option>
            <option value="å…§å´">å…§å´</option>
            <option value="å¤–å´">å¤–å´</option>
          </select>
        </div>

        <div class="pair-row" id="row-stem-p">
          <span class="tag">è–ï¼šéŸŒçš®éƒ¨</span>
          <span class="arrow" aria-hidden="true">â†’</span>
          <label for="stemP" class="visually-hidden">è–éŸŒçš®éƒ¨ä½ç½®</label>
          <select id="stemP" class="dropdown" aria-label="è–éŸŒçš®éƒ¨ä½ç½®">
            <option value="">è«‹é¸æ“‡</option>
            <option value="å…§å´">å…§å´</option>
            <option value="å¤–å´">å¤–å´</option>
          </select>
        </div>

        <div class="btn-wrap">
          <button id="check2" class="btn btn-primary" type="button" disabled aria-disabled="true" aria-controls="res2">æª¢æŸ¥ç­”æ¡ˆ</button>
          <button id="redo2" class="btn btn-ghost" type="button" hidden>é‡åšæœ¬é¡Œ</button>
        </div>
        <div id="res2" class="result" aria-live="polite"></div>
      </div>

      <!-- Q3ï¼šå¤šé¸é¡Œ -->
      <div class="q" role="group" aria-labelledby="q3">
        <div id="q3" class="q-title">é¡Œç›®ä¸‰ï½œå‹¾é¸æ‰€æœ‰æ­£ç¢ºçš„æ•˜è¿°ï¼ˆè‡³å°‘ 2 é …ï¼‰</div>
        <div class="mcq" id="row-msq">
          <fieldset style="border:0;margin:0;padding:0">
            <legend class="visually-hidden">ç¶­ç®¡æŸæ¦‚å¿µå¤šé¸</legend>
            <label><input type="checkbox" class="ms" value="A"> æœ¨è³ªéƒ¨ä¸»è¦é‹è¼¸æ°´åˆ†èˆ‡ç¤¦ç‰©è³ªã€‚</label><br>
            <label><input type="checkbox" class="ms" value="B"> éŸŒçš®éƒ¨è² è²¬é‹è¼¸å…‰åˆä½œç”¨ç”¢ç”Ÿçš„é¤Šåˆ†ã€‚</label><br>
            <label><input type="checkbox" class="ms" value="C"> è‘‰è„ˆä¸­éŸŒçš®éƒ¨åœ¨ä¸Šå´ã€é è¿‘ä¸Šè¡¨çš®ã€‚</label><br>
            <label><input type="checkbox" class="ms" value="D"> åœ¨è–å…§éƒ¨ï¼Œæœ¨è³ªéƒ¨é€šå¸¸ä½æ–¼å¤–å´ã€éŸŒçš®éƒ¨åœ¨å…§å´ã€‚</label>
          </fieldset>
        </div>
        <div class="btn-wrap">
          <button id="check3" class="btn btn-primary" type="button" disabled aria-disabled="true" aria-controls="res3">æª¢æŸ¥ç­”æ¡ˆ</button>
          <button id="redo3" class="btn btn-ghost" type="button" hidden>é‡åšæœ¬é¡Œ</button>
        </div>
        <div id="res3" class="result" aria-live="polite"></div>
      </div>
    </section>

    <!-- å°è¦½ -->
    <nav class="nav" aria-label="é é¢å°è¦½">
      <a class="prev" href="index.html" target="_self" aria-label="ä¸Šä¸€é ">â† ä¸Šä¸€é </a>
      <a id="nextBtn" class="next disabled" href="./2.html" target="_self" aria-label="ä¸‹ä¸€é " aria-disabled="true">ä¸‹ä¸€é  â†’</a>
    </nav>
  </main>

  <!-- åœ–ç‰‡æ”¾å¤§ç”¨ Lightbox -->
  <div id="lightbox" class="lightbox" role="dialog" aria-modal="true" aria-label="åœ–ç‰‡æ”¾å¤§æª¢è¦–">
    <button class="close-btn" aria-label="é—œé–‰æ”¾å¤§åœ–" id="lbClose">âœ•</button>
    <figure><img id="lbImg" alt=""></figure>
  </div>

  <script>
    // ç‹€æ…‹
    let q1Ok=false,q2Ok=false,q3Ok=false;

    // å…ƒç´ 
    const el={
      // Q1
      xylem:document.getElementById('xylem'),
      phloem:document.getElementById('phloem'),
      rowXy:document.getElementById('row-xylem'),
      rowPh:document.getElementById('row-phloem'),
      chk1:document.getElementById('check1'),
      redo1:document.getElementById('redo1'),
      res1:document.getElementById('res1'),
      // Q2
      leafX:document.getElementById('leafX'),
      leafP:document.getElementById('leafP'),
      stemX:document.getElementById('stemX'),
      stemP:document.getElementById('stemP'),
      rowLX:document.getElementById('row-leaf-x'),
      rowLP:document.getElementById('row-leaf-p'),
      rowSX:document.getElementById('row-stem-x'),
      rowSP:document.getElementById('row-stem-p'),
      chk2:document.getElementById('check2'),
      redo2:document.getElementById('redo2'),
      res2:document.getElementById('res2'),
      // Q3 å¤šé¸
      ms:document.querySelectorAll('.ms'),
      rowMS:document.getElementById('row-msq'),
      chk3:document.getElementById('check3'),
      redo3:document.getElementById('redo3'),
      res3:document.getElementById('res3'),
      // nav/progress
      next:document.getElementById('nextBtn'),
      progText:document.getElementById('progText'),
      progBar:document.getElementById('progBar'),
      // lightbox
      lb:document.getElementById('lightbox'),
      lbImg:document.getElementById('lbImg'),
      lbClose:document.getElementById('lbClose')
    };

    // å•Ÿç”¨æª¢æŸ¥éµåˆ¤æ–·
    function tChk1(){ const ok=el.xylem.value&&el.phloem.value; el.chk1.disabled=!ok; el.chk1.setAttribute('aria-disabled',String(!ok)); }
    function tChk2(){ const ok=el.leafX.value&&el.leafP.value&&el.stemX.value&&el.stemP.value; el.chk2.disabled=!ok; el.chk2.setAttribute('aria-disabled',String(!ok)); }
    function tChk3(){
      const selected=[...el.ms].filter(i=>i.checked).length;
      const ok = selected>=2; // è‡³å°‘ 2 é …æ‰å¯æäº¤
      el.chk3.disabled=!ok; el.chk3.setAttribute('aria-disabled',String(!ok));
    }

    ['change','keyup'].forEach(e=>{
      el.xylem.addEventListener(e,tChk1); el.phloem.addEventListener(e,tChk1);
      el.leafX.addEventListener(e,tChk2); el.leafP.addEventListener(e,tChk2);
      el.stemX.addEventListener(e,tChk2); el.stemP.addEventListener(e,tChk2);
    });
    el.ms.forEach(cb=>cb.addEventListener('change', tChk3));

    // é‡åšå·¥å…·
    function resetQ1(){ [el.rowXy,el.rowPh].forEach(r=>r.classList.remove('correct','incorrect')); el.xylem.value=""; el.phloem.value=""; el.res1.style.display="none"; el.chk1.disabled=true; el.chk1.setAttribute('aria-disabled','true'); el.redo1.hidden=true; }
    function resetQ2(){ [el.rowLX,el.rowLP,el.rowSX,el.rowSP].forEach(r=>r.classList.remove('correct','incorrect')); el.leafX.value=""; el.leafP.value=""; el.stemX.value=""; el.stemP.value=""; el.res2.style.display="none"; el.chk2.disabled=true; el.chk2.setAttribute('aria-disabled','true'); el.redo2.hidden=true; }
    function resetQ3(){
      el.rowMS.classList.remove('correct','incorrect');
      el.ms.forEach(i=>i.checked=false);
      el.res3.style.display="none"; el.chk3.disabled=true; el.chk3.setAttribute('aria-disabled','true'); el.redo3.hidden=true;
    }

    // é¡Œç›®ä¸€æª¢æŸ¥
    function check1(){
      [el.rowXy,el.rowPh].forEach(r=>r.classList.remove('correct','incorrect'));
      const a = el.xylem.value==='æ°´åˆ†èˆ‡ç¤¦ç‰©è³ª';
      const b = el.phloem.value==='å…‰åˆä½œç”¨çš„é¤Šåˆ†';
      el.rowXy.classList.add(a?'correct':'incorrect');
      el.rowPh.classList.add(b?'correct':'incorrect');
      if(a&&b){ el.res1.className='result ok'; el.res1.textContent='âœ… æ­£ç¢ºï¼šæœ¨è³ªéƒ¨â†’æ°´åˆ†èˆ‡ç¤¦ç‰©è³ªï¼›éŸŒçš®éƒ¨â†’å…‰åˆä½œç”¨çš„é¤Šåˆ†ã€‚'; q1Ok=true; }
      else{ el.res1.className='result ng'; el.res1.textContent='âŒ å†æƒ³æƒ³ï¼æœ¨è³ªéƒ¨é‹è¼¸æ°´èˆ‡ç¤¦ç‰©ï¼›éŸŒçš®éƒ¨é‹è¼¸å…‰åˆä½œç”¨ç”¢ç‰©ã€‚'; q1Ok=false; }
      el.res1.style.display='block'; el.chk1.disabled=true; el.chk1.setAttribute('aria-disabled','true'); el.redo1.hidden=false; updateNext();
    }

    // é¡Œç›®äºŒæª¢æŸ¥
    function check2(){
      [el.rowLX,el.rowLP,el.rowSX,el.rowSP].forEach(r=>r.classList.remove('correct','incorrect'));
      const okLX=el.leafX.value==='ä¸Šå´', okLP=el.leafP.value==='ä¸‹å´', okSX=el.stemX.value==='å…§å´', okSP=el.stemP.value==='å¤–å´';
      el.rowLX.classList.add(okLX?'correct':'incorrect');
      el.rowLP.classList.add(okLP?'correct':'incorrect');
      el.rowSX.classList.add(okSX?'correct':'incorrect');
      el.rowSP.classList.add(okSP?'correct':'incorrect');
      const allOk = okLX&&okLP&&okSX&&okSP;
      if(allOk){ el.res2.className='result ok'; el.res2.textContent='ğŸ‰ å…¨å°ï¼šè‘‰ä¸Šæœ¨ä¸‹éŸŒï¼›è–å…§æœ¨å¤–éŸŒã€‚'; q2Ok=true; }
      else{ const n=[okLX,okLP,okSX,okSP].filter(Boolean).length; el.res2.className='result ng'; el.res2.textContent=`ç›®å‰æ­£ç¢º ${n}/4ï¼Œæç¤ºï¼šè‘‰ä¸Šæœ¨ä¸‹éŸŒï¼›è–å…§æœ¨å¤–éŸŒã€‚`; q2Ok=false; }
      el.res2.style.display='block'; el.chk2.disabled=true; el.chk2.setAttribute('aria-disabled','true'); el.redo2.hidden=false; updateNext();
    }

    // é¡Œç›®ä¸‰æª¢æŸ¥ï¼ˆå¤šé¸ï¼Œæ­£è§£ç‚º A èˆ‡ Bï¼‰
    function check3(){
      el.rowMS.classList.remove('correct','incorrect');
      const choose = new Set([...el.ms].filter(i=>i.checked).map(i=>i.value));
      const correct = new Set(['A','B']);
      const isExact = choose.size===correct.size && [...correct].every(v=>choose.has(v));

      el.rowMS.classList.add(isExact?'correct':'incorrect');

      if(isExact){
        el.res3.className='result ok';
        el.res3.textContent='âœ… åšå¾—å¥½ï¼æ­£ç¢ºé¸é …ï¼šæœ¨è³ªéƒ¨é‹è¼¸æ°´èˆ‡ç¤¦ç‰©ï¼›éŸŒçš®éƒ¨é‹è¼¸å…‰åˆä½œç”¨ç”¢ç‰©ã€‚';
        q3Ok=true;
      }else{
        const picked=[...choose].sort().join('ã€') || 'ï¼ˆæœªé¸ï¼‰';
        el.res3.className='result ng';
        el.res3.textContent=`âŒ ç›®å‰å‹¾é¸ï¼š${picked}ã€‚æç¤ºï¼šè‘‰ä¸Šæœ¨ä¸‹éŸŒï¼›è–å…§æœ¨å¤–éŸŒã€‚æ­£ç¢ºå‹¾é¸æ‡‰ç‚ºå‰å…©é …ã€‚`;
        q3Ok=false;
      }
      el.res3.style.display='block';
      el.chk3.disabled=true; el.chk3.setAttribute('aria-disabled','true');
      el.redo3.hidden=false;
      updateNext();
    }

    // è§£é–ä¸‹ä¸€é  + é€²åº¦æ¢
    function updateNext(){
      const done=[q1Ok,q2Ok,q3Ok].filter(Boolean).length;
      el.progText.textContent=`å®Œæˆåº¦ï¼š${done}/3`;
      el.progBar.style.width=`${(done/3)*100}%`;
      const canGo = done===3;
      el.next.classList.toggle('disabled',!canGo);
      el.next.setAttribute('aria-disabled',String(!canGo));
    }

    // ç¶å®š
    document.getElementById('check1').addEventListener('click',check1);
    document.getElementById('check2').addEventListener('click',check2);
    document.getElementById('check3').addEventListener('click',check3);

    el.redo1.addEventListener('click',()=>{resetQ1(); q1Ok=false; updateNext();});
    el.redo2.addEventListener('click',()=>{resetQ2(); q2Ok=false; updateNext();});
    el.redo3.addEventListener('click',()=>{resetQ3(); q3Ok=false; updateNext();});

    // Lightbox
    document.querySelectorAll('.zoomable').forEach(img=>{
      img.addEventListener('click', ()=>{
        el.lbImg.src=img.getAttribute('src'); el.lbImg.alt=img.alt||''; el.lb.classList.add('open'); el.lbClose.focus();
      });
    });
    el.lbClose.addEventListener('click',()=>el.lb.classList.remove('open'));
    el.lb.addEventListener('click',(e)=>{ if(e.target===el.lb) el.lb.classList.remove('open'); });
    window.addEventListener('keydown',(e)=>{ if(e.key==='Escape') el.lb.classList.remove('open'); });
  </script>
</body>
</html>
